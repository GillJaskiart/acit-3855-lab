openapi: 3.0.3
info:
  description: Receives batch events from school-zone sensors/cameras for speeding violations and traffic congestion counts.
  version: 1.0.0
  title: School Zone Traffic Event Ingestion API
  contact:
    email: jgill391@my.bcit.ca

paths:
  /events/speeding:
    post:
      summary: Receive a batch of school-zone speeding violation records
      operationId: app.receive_speeding_batch
      description: Stores a batch of speeding violation events from a single device.
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SpeedingViolationBatch"
      responses:
        "201":
          description: Batch successfully received
        "400":
          description: Invalid input (schema validation failed)

    get:
      summary: Get speeding events between timestamps
      operationId: app.get_speeding_events
      description: Gets speeding events received over a timespan
      parameters:
        - name: start_timestamp
          in: query
          required: true
          description: Start of the timespan
          schema:
            type: string
            format: date-time
            example: "2026-02-10T08:00:00Z"
        - name: end_timestamp
          in: query
          required: true
          description: End of the timespan
          schema:
            type: string
            format: date-time
            example: "2026-02-10T09:00:00Z"
      responses:
        "200":
          description: Successfully returned a list of speeding events
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/SpeedingViolationBatch"
        "400":
          description: Invalid request

  /events/congestion:
    post:
      summary: Receive a batch of school-zone congestion count records
      operationId: app.receive_congestion_batch
      description: Stores a batch of vehicle-passage counts from a single device.
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CongestionCountBatch"
      responses:
        "201":
          description: Batch successfully received
        "400":
          description: Invalid input (schema validation failed)

    get:
      summary: Get congestion events between timestamps
      operationId: app.get_congestion_events
      description: Gets congestion events received over a timespan
      parameters:
        - name: start_timestamp
          in: query
          required: true
          description: Start of the timespan (inclusive)
          schema:
            type: string
            format: date-time
            example: "2026-01-09T08:00:00Z"
        - name: end_timestamp
          in: query
          required: true
          description: End of the timespan (exclusive)
          schema:
            type: string
            format: date-time
            example: "2026-01-09T09:00:00Z"
      responses:
        "200":
          description: Successfully returned a list of congestion events
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/CongestionCountBatch"
        "400":
          description: Invalid request


components:
  schemas:
    SpeedingViolationBatch:
      type: object
      required:
        - sender_id
        - location_id
        - trace_id
        - speed_kmh
        - direction
        - speed_limit_kmh
        - batch_timestamp
        - reading_timestamp
      properties:
        sender_id:
          type: string
          format: uuid
          example: "d290f1ee-6c54-4b01-90e6-d701748f0851"
        location_id:
          type: string
          description: Identifier for the school-zone location.
          example: "SZ-042"
        trace_id:
          type: string
          format: uuid
          example: "b1a2c3d4-1111-2222-3333-abcdefabcdef"

        speed_kmh:
          type: number
          example: 52.4
        speed_limit_kmh:
          type: number
          example: 30
        direction:
          type: string
          enum: ["NORTHBOUND", "SOUTHBOUND", "EASTBOUND", "WESTBOUND"]
          example: "NORTHBOUND"
        batch_timestamp:
          type: string
          format: date-time
          description: Timestamp when the Receiver sent the batch (was sent_timestamp).
          example: "2026-01-09T08:00:00Z"
        reading_timestamp:
          type: string
          format: date-time
          description: Timestamp when the sensor recorded the violation (was recorded_timestamp).
          example: "2026-01-09T07:43:12Z"

    CongestionCountBatch:
      type: object
      required:
        - sender_id
        - location_id
        - trace_id
        - vehicles_passing
        - interval_seconds
        - direction
        - batch_timestamp
        - reading_timestamp
      properties:
        sender_id:
          type: string
          format: uuid
          example: "a12b3c4d-1111-2222-3333-abcdefabcdef"
        location_id:
          type: string
          example: "SZ-042"
        trace_id:
          type: string
          format: uuid
          example: "b1a2c3d4-1111-2222-3333-abcdefabcdef"

        vehicles_passing:
          type: integer
          example: 38
        interval_seconds:
          type: integer
          example: 60
        direction:
          type: string
          enum: ["NORTHBOUND", "SOUTHBOUND", "EASTBOUND", "WESTBOUND"]
          example: "NORTHBOUND"

        batch_timestamp:
          type: string
          format: date-time
          description: Timestamp when the Receiver sent the batch (was sent_timestamp).
          example: "2026-01-09T08:00:00Z"
        reading_timestamp:
          type: string
          format: date-time
          description: Timestamp when the sensor recorded the count (was recorded_timestamp).
          example: "2026-01-09T07:59:59Z"
